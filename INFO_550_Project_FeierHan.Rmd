---
title: "INFO550_Project_FeierHan"
author: "Feier"
date: "2021/9/23"
output: 
 html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,include=FALSE)
```

```{r, warning=FALSE}
#library
#library(openxlsx)
library(dplyr)
library(tidyr)
library(stringr)
library(corrgram)
library(here)
library(table1)

#path
here::i_am("INFO_550_Project_FeierHan.Rmd")
# run the R code from the root directory
#knitr::opts_knit$set(root.dir = here::here("INFO_550_Project_FeierHan.Rmd"))
```

```{r}
# read data
#dat1<-read.xlsx( "2008.xlsx")
dat1<-read.csv(here("SmokingAndTobaccoData2008.csv"),fileEncoding = "UTF-8") %>% mutate(Year=2008)
dat2<-read.csv(here("SmokingAndTobaccoData2010.csv"),fileEncoding = "UTF-8") %>% mutate(Year=2010)
dat3<-read.csv(here("SmokingAndTobaccoData2012.csv"),fileEncoding = "UTF-8") %>% mutate(Year=2012)
dat4<-read.csv(here("SmokingAndTobaccoData2014.csv"),fileEncoding = "UTF-8") %>% mutate(Year=2014)
dat5<-read.csv(here("SmokingAndTobaccoData2016.csv"),fileEncoding = "UTF-8") %>% mutate(Year=2016)

#dar 6 has different variable and different names, just ignore it right now
#dat6<-read.csv(here("SmokingAndTobaccoData2018.csv")) %>% mutate(Year=2018)

```

```{r}
dat1$Year = 2008
dat2$Year = 2010
dat3$Year = 2012
dat4$Year = 2014
dat5$Year = 2016
data<-rbind(dat1,dat2,dat3,dat4,dat5)

```

```{r}
# data cleaning
data1 <- data %>%
          separate(CigaretteSmokingPrevalence,into = c("cig_smoke"),sep = " ") %>%
          separate(TobaccoSmokingPrevalence,into = c("toba_smoke"),sep = " ") %>%
          separate(TobaccoUsePrevalance,into = c("toba_use"),sep = " ") %>%
          mutate(cig_smoke = as.numeric(cig_smoke),
                 toba_smoke = as.numeric(toba_smoke),
                 toba_use = as.numeric(toba_use)) %>%
          filter(Location != "C") 
          
label(data1$cig_smoke) <- "Cigarette Smoking Prevalence"
label(data1$toba_smoke) <- "Tobacco Smoking Prevalence"
label(data1$toba_use) <- "Tobacco Use Prevalance"

#save data
write.csv(data1,here("INFO550_HW4_data", na = ""))
       
```

## Summary Table

```{r}
table1 <- table1 ( ~ cig_smoke + toba_smoke + toba_use | Year, 
                   data = data1, overall = F,
                  # extra.col = list("P-value" = pvalue)
                 )
table1

#save table
#write.table(table1,"")
```


## Cigarette and Tobacco

### Distribution of cigarette smoking, tobacco smoking and tobacco use prevalence

-   Distribution of cigarette and tobacco prevalence are similar

```{r}
jpeg('figure1.jpg')
par(mfrow=c(1,3))
hist(data1$cig_smoke,main = "cigarette smoking prevalence")
hist(data1$toba_smoke,main = "tobacco smoking prevalence")
hist(data1$toba_use,main = "tobacco use prevalence")

dev.off()
```

### Correlation between cigarette and tobacco prevalence

-   Correlations are between **0.71-0.87**, which is relatively high

-   Clearly there is a positive association between cigarette and tobacco prevalence

```{r}
jpeg('figure2.jpg')
corrgram(data1[,2:4],lower.panel = panel.shade,upper.panel = panel.cor)
dev.off()
```

## Further Analysis

### Goal

1.  Investigate the association between scope of regulation on smoke-free environment and the prevalence of smoking

2.  Investigate the association between Treatment In Health Facilities and the prevalence of smoking

3.  Identify the most effective smoke-free environment regulation
